#!/bin/sh
echo "=============================================="
echo "Dream Stream Installer for DreamOS"
echo "=============================================="

# ุชุนุฑูู ุงููุณุงุฑุงุช
TEMP_FILE="/tmp/Dream_Stream.tar.gz"
TEMP_DIR="/tmp/Dream_Stream"
PLUGINS_DIR="/usr/lib/enigma2/python/Plugins/Extensions"

# ุงูุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
if [ $(id -u) -ne 0 ]; then
    echo "โ๏ธ  ูุฑุฌู ุชุดุบูู ุงูุณูุฑูุจุช ุจุตูุงุญูุงุช root"
    echo "ุงุณุชุฎุฏู: sudo ./install_dream_stream.sh"
    exit 1
fi

# ุงูุชุญูู ูู ูุณุงุฑ ุงูุฅุถุงูุงุช
if [ ! -d "$PLUGINS_DIR" ]; then
    echo "โ ูุฌูุฏ ุงูุฅุถุงูุงุช ุบูุฑ ููุฌูุฏ: $PLUGINS_DIR"
    exit 1
fi

# ุชูุธูู ุฃู ูููุงุช ูุฏููุฉ
echo "๐งน ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ ุงููุฏููุฉ..."
rm -rf "$TEMP_FILE" "$TEMP_DIR"

# ุชุญููู ุงูุญุฒูุฉ
echo "๐ฅ ุฌุงุฑู ุชุญููู Dream Stream..."
wget -O "$TEMP_FILE" "https://github.com/Said-Pro/StalkerOS/raw/refs/heads/main/Dream_Stream.tar.gz"

# ุงูุชุญูู ูู ูุฌุงุญ ุงูุชุญููู
if [ $? -ne 0 ]; then
    echo "โ ูุดู ูู ุชุญููู ุงูุญุฒูุฉ"
    exit 1
fi

if [ ! -f "$TEMP_FILE" ]; then
    echo "โ ุงูููู ุงููุญูู ุบูุฑ ููุฌูุฏ"
    exit 1
fi

echo "โ ุชู ุงูุชุญููู ุจูุฌุงุญ"

# ูู ุงูุถุบุท
echo "๐ฆ ุฌุงุฑู ูู ุถุบุท ุงูุญุฒูุฉ..."
tar -xzf "$TEMP_FILE" -C /tmp/

if [ $? -ne 0 ]; then
    echo "โ ูุดู ูู ูู ุงูุถุบุท"
    exit 1
fi

# ุงูุชุญูู ูู ูุฌูุฏ ุงููุฌูุฏ ุจุนุฏ ูู ุงูุถุบุท
if [ ! -d "$TEMP_DIR" ]; then
    echo "โ ุงููุฌูุฏ ุบูุฑ ููุฌูุฏ ุจุนุฏ ูู ุงูุถุบุท"
    exit 1
fi

echo "โ ุชู ูู ุงูุถุบุท ุจูุฌุงุญ"

# ูุณุฎ ุงููููุงุช
echo "๐ ุฌุงุฑู ุชุซุจูุช ุงููููุงุช..."
cp -r "$TEMP_DIR"/* "$PLUGINS_DIR/"

if [ $? -ne 0 ]; then
    echo "โ ูุดู ูู ูุณุฎ ุงููููุงุช"
    exit 1
fi

# ููุญ ุงูุตูุงุญูุงุช ุงูููุงุณุจุฉ
echo "๐ ููุญ ุงูุตูุงุญูุงุช ุงููุงุฒูุฉ..."
find "$PLUGINS_DIR" -name "*.py" -exec chmod 644 {} \;
find "$PLUGINS_DIR" -name "*.so" -exec chmod 755 {} \;
find "$PLUGINS_DIR" -name "*.sh" -exec chmod 755 {} \;

echo "โ ุชู ููุญ ุงูุตูุงุญูุงุช"

# ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ
echo "๐งน ุชูุธูู ุงููููุงุช ุงููุคูุชุฉ..."
rm -rf "$TEMP_FILE" "$TEMP_DIR"

echo "โ ุชู ุงูุชูุธูู"

# ุฅุนุงุฏุฉ ุชุดุบูู Enigma2
echo "๐ ุฌุงุฑู ุฅุนุงุฏุฉ ุชุดุบูู Enigma2..."
systemctl restart enigma2

if [ $? -eq 0 ]; then
    echo "=============================================="
    echo "๐ ุชู ุงูุชุซุจูุช ุจูุฌุงุญ!"
    echo "๐ ุชูุช ุฅุถุงูุฉ Dream Stream ุฅูู ูุงุฆูุฉ ุงูุฅุถุงูุงุช"
    echo "=============================================="
else
    echo "โ๏ธ  ุชู ุงูุชุซุจูุช ูููู ููุงู ูุดููุฉ ูู ุฅุนุงุฏุฉ ุงูุชุดุบูู"
    echo "ูุฑุฌู ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฌูุงุฒ ูุฏููุงู"
fi
